---
import type { ProductData } from '@/env'

import Layout from '@/product/layouts/Layout.astro'

import SimilarProducts from '@/product/components/SimilarProducts.astro'
import ViewProduct from '@/product/components/ViewProduct.astro'

import { APIProducts } from '@/services/API'

export const getStaticPaths = async () => {
  const data = (await APIProducts.getProducts()) || []

  return data.map((data) => ({
    params: {
      id: data.id,
    },
    props: {
      fields: data,
    },
  }))
}

const { id } = Astro.params

const { fields } = Astro.props

const products: ProductData =
  (await APIProducts.getSimilarProducts({
    id: id,
    collection: fields.collection,
  })) || []
---

<Layout title="id">
  <!-- <SearchProducts /> -->

  <ViewProduct {...fields} />

  <SimilarProducts products={products} />
</Layout>
